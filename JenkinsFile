def artifactname = "sp-boot-app.jar"
def repoName = "sp-boot-app-repo"
def pipelineName = "devops_vk_pipeline"
def semanticVersion = "${env.BUILD_NUMBER}.0.0"
def packageName = "spboot-package_${env.BUILD_NUMBER}"
def version = "${env.BUILD_NUMBER}.0"
def pkgName = "sp-boot-package"

pipeline {
  agent any
  tools {
       maven 'Maven'
   }
  stages {
       stage('Connect_to_Nexus') {
           steps {
              snDevOpsStep()
              sh 'mvn -B -DskipTests clean compile'

           }
       }
       stage('Download_Artifacts') {
           steps {
              snDevOpsStep()
              sh 'mvn test'
           }
           post {
             always {
                junit "**/target/surefire-reports/*.xml"
             }
           }
       }
      stage('GetPullRequest') {
                 steps {
                    snDevOpsStep()
                    echo 'Deploying the change........'
                    snDevOpsChange()
		    
                 }
      }

     stage('MergePullRequest') { 
	            steps {
	            	snDevOpsStep (enabled:true)
	               //snDevOpsStep (stepSysId:'47828d591b9c60106951da86cc4bcbfa', ignoreErrors:true)
	               
	               snDevOpsChange()
	               echo 'Publishing Artifacts....'
                	sleep 3
					//snDevOpsArtifact(artifactsPayload:"""{"artifacts": [{"name": "${artifactname}-${env.BUILD_NUMBER}","semanticVersion": "${semanticVersion}","repositoryName": "${repoName}"}],"stageName": "PublishArtifacts"}""")            
	                snDevOpsArtifact(artifactsPayload: """{"artifacts": [{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}","semanticVersion": "1.${env.BUILD_NUMBER}.0","repositoryName": "${repoName}"}],"branchName":"master"}""")
	           
	            }
	            
	        }

		stage('Build') {
         steps {
         	snDevOpsStep (enabled:true)
            //snDevOpsStep (stepSysId:'5b9281591b9c60106951da86cc4bcbfe', ignoreErrors:true)
            echo 'Publishing Package....'
         	//snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
            snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
        withSonarQubeEnv('Sonar_Cloud') {
					sh '${SCANNER_HOME}/bin/sonar-scanner -Dproject.settings=${SCANNER_HOME}/conf/qa-sonar-scanner-cloud.properties'
			       
	        	}
         }
 	}
	stage('UnitTest') {
         steps {
         	snDevOpsStep (enabled:true)
            //snDevOpsStep (stepSysId:'5b9281591b9c60106951da86cc4bcbfe', ignoreErrors:true)
            echo 'Publishing Package....'
         	//snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
            snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
        
         }
 	}
	stage('ITTest') {
         steps {
         	snDevOpsStep (enabled:true)
            //snDevOpsStep (stepSysId:'5b9281591b9c60106951da86cc4bcbfe', ignoreErrors:true)
            echo 'Publishing Package....'
         	//snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
            snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
        
         }
 	}
	stage('Deploy') {
         steps {
         	snDevOpsStep (enabled:true)
            //snDevOpsStep (stepSysId:'5b9281591b9c60106951da86cc4bcbfe', ignoreErrors:true)
            echo 'Publishing Package....'
         	//snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
            snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
        
         }
 	}
	stage('Init_Service') {
         steps {
         	snDevOpsStep (enabled:true)
            //snDevOpsStep (stepSysId:'5b9281591b9c60106951da86cc4bcbfe', ignoreErrors:true)
            echo 'Publishing Package....'
         	//snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
            snDevOpsPackage(name: "${pkgName}-${env.BUILD_NUMBER}", artifactsPayload: """{"artifacts":[{"name": "${artifactname}", "version": "1.${env.BUILD_NUMBER}", "repositoryName": "${repoName}"}], "branchName":"master"}""")
        
         }
 	}
 }
 
}
def printLogs() {
    sh "echo Going to echo a list"
    for (int i = 0; i < 2; i++) {
      String s1 ="Lorem ipsum dolor sit amet, consectetur adipiscing elitddsfdsvsdvdv dsdsvvv sdgsdv, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.  veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. JenkinFile  is also contains random String for increasing  log size  jerkin File which can be further help to test the file size impact on Mid server jerkin."
      for (int j = 0; j < 10; j++) {
          s1 += s1;
          println s1
          sh "echo Hello  dsfsfd fsd fds fdsf sdf sdf dsf dsf"
      }
    }
  }
